name: RAVA actions

on:
  workflow_call:
    secrets:
      lava_token:
        required: true

jobs:
  trait-push-change-file:
    if: ${{ github.event_name == 'push' }}
    outputs:
      files: ${{ steps.get-files.outputs.files }}
    runs-on: 'ubuntu-latest'
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 2
      - id: get-files
        run: |
          files=$(git diff --name-only HEAD^ HEAD)
          echo "files=$files" >> $GITHUB_OUTPUT

  trait-pr-change-file:
    if: ${{ github.event_name == 'pull_request' }}
    outputs:
      files: ${{ steps.get-files.outputs.files }}
    runs-on: 'ubuntu-latest'
    steps:
      - id: get-files
        run: |
          files=$(gh pr diff ${{ github.event.pull_request.number }} --name-only)
          echo "files=$files" >> $GITHUB_OUTPUT

  show-files:
    runs-on: 'ubuntu-latest'
    needs: [trait-push-change-file, trait-pr-change-file]
    env:
      files: ${{ needs.trait-push-change-file.outputs.files }}, ${{ needs.trait-pr-change-file.outputs.files }}
    steps:
      - run: |
         echo $files
      